<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login Owner - Dapur Kana</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50 min-h-screen flex items-center justify-center p-4">
  <div class="w-full max-w-md bg-white rounded-xl shadow-xl p-6">

    <!-- Login Form -->
    <div id="loginSection">
      <h2 class="text-xl font-bold mb-4">üîê Login Owner</h2>
      <input type="email" id="email" placeholder="Email" class="w-full border p-2 rounded mb-3" required>
      <input type="password" id="password" placeholder="Password" class="w-full border p-2 rounded mb-3" required>
     <button id="loginBtn" class="w-full bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">Login</button>
      <p id="loginError" class="text-red-500 text-sm mt-3 hidden">‚ùå Email atau Password salah.</p>
    </div>

    <!-- Menu Form -->
    <div id="menuSection" class="hidden">
      <h2 class="text-xl font-bold mb-4">üìù Tambah Menu</h2>
      <form id="menuForm" class="space-y-3">
        <input type="text" id="name" placeholder="Nama Menu" required class="w-full border p-2 rounded" />
        <input type="number" id="price" placeholder="Harga (angka)" required class="w-full border p-2 rounded" />
        <input type="text" id="description" placeholder="Deskripsi" class="w-full border p-2 rounded" />
        <input type="text" id="category" placeholder="Kategori" class="w-full border p-2 rounded" />
        <input type="file" id="image" accept="image/*" required class="w-full border p-2 rounded" />
        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">Tambah Menu</button>
        <button type="button" onclick="logout()" class="w-full mt-2 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded">Logout</button>
      </form>
    </div>

  </div>

  <script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

  const supabase = createClient(
    'https://artqoamgcuwyvuprpvgt.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFydHFvYW1nY3V3eXZ1cHJwdmd0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzMjQzODMsImV4cCI6MjA2OTkwMDM4M30.yEED0Dte55TYy6UOkJ0wVVkeYjAtcDk18MRGMLhxIpY'
  );

  // Fungsi login
  document.getElementById('loginBtn').addEventListener('click', async () => {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;

    const { data, error } = await supabase.auth.signInWithPassword({ email, password });

    if (error) {
      document.getElementById('loginError').textContent = `Login gagal: ${error.message}`;
      document.getElementById('loginError').classList.remove('hidden');
    } else {
      document.getElementById('loginSection').classList.add('hidden');
      document.getElementById('menuSection').classList.remove('hidden');
    }
  });

  // Fungsi logout
  window.logout = async function () {
    await supabase.auth.signOut();
    location.reload();
  };

  // Cek sesi login saat halaman dibuka
  window.addEventListener('DOMContentLoaded', async () => {
    const { data: { session } } = await supabase.auth.getSession();
    if (session) {
      document.getElementById('loginSection').classList.add('hidden');
      document.getElementById('menuSection').classList.remove('hidden');
    }
  });

  // Upload menu
  document.getElementById('menuForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const name = document.getElementById('name').value;
    const price = parseInt(document.getElementById('price').value);
    const description = document.getElementById('description').value;
    const category = document.getElementById('category').value;
    const imageFile = document.getElementById('image').files[0];

    if (!imageFile) return alert('Pilih gambar terlebih dahulu.');

    const fileExt = imageFile.name.split('.').pop();
    const fileName = `${Date.now()}.${fileExt}`;
    const filePath = `${category}/${fileName}`;

    const { data: uploadData, error: uploadError } = await supabase.storage
      .from('menu')
      .upload(filePath, imageFile);

    if (uploadError) return alert('Upload gagal: ' + uploadError.message);

    const { data: publicUrlData } = supabase
      .storage
      .from('menu')
      .getPublicUrl(filePath);

    const image_url = publicUrlData.publicUrl;

    const { error: insertError } = await supabase
      .from('menu')
      .insert([{ name, price, description, category, image_url }]);

    if (insertError) {
      alert('Gagal simpan: ' + insertError.message);
    } else {
      alert('Menu berhasil ditambahkan!');
      document.getElementById('menuForm').reset();
    }
  });
</script>
</body>
</html>
